<app-navbar></app-navbar>
<div class="module-container relative">
<app-main-sidebar></app-main-sidebar>
<div [ngClass]="showSidebarMenu ? 'content' : 'content-full'" #myDiv>
<router-outlet></router-outlet>
</div>

<div class="chat_icon" *ngIf="showChat" (click)="op.toggle($event)">
    <svg (click)="op.toggle($event)"  width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M14 14H14.0179M25.9821 14H26" stroke="#006F71" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M35.9821 29H36M28 29H28.0179" stroke="#006F71" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M20 32C20 37.5228 25.3726 42 32 42C33.8144 42 35.5347 41.6645 37.0764 41.0638C37.4533 40.9169 37.8623 40.8641 38.26 40.9377L44 42L42.6966 37.9405C42.5062 37.3477 42.6151 36.7065 42.9151 36.161C43.6117 34.894 44 33.4848 44 32C44 26.4772 38.6274 22 32 22C25.3726 22 20 26.4772 20 32Z" stroke="#006F71" stroke-width="3" stroke-linejoin="round"/>
      <path d="M35.7463 22.497C35.913 21.6867 36 20.8522 36 20C36 12.268 28.8366 6 20 6C11.1634 6 4 12.268 4 20C4 22.2247 4.59306 24.3283 5.6484 26.1962C5.94204 26.7159 6.03942 27.3306 5.86486 27.9015L4 34L11.8283 32.4788C12.2437 32.3981 12.6724 32.4546 13.0624 32.6189C15.2312 33.5324 17.6828 34.0313 20.2397 33.9985" stroke="#006F71" stroke-width="3" stroke-linejoin="round"/>
      </svg>      
  </div>

  <p-overlayPanel
  #op
  appendTo="body"
  styleClass="chat"
  (onShow)="positionOverlay(op)"
>
  <div class="flex justify-between w-full">
    <div class="flex gap-2">
      <div class="minimize" (click)="op.hide()">
        <img class="w-full" src="../../../assets/images/minimize_icon.svg" alt="" />
      </div>
      <img src="../../../assets/images/chat_haal_logo.svg" alt="" />
    </div>
    <div class="ai">
      <span>تحليل الأداء الذكي (Smart Performance Analyzer)</span
        >      <div>
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clip-path="url(#clip0_2623_11064)">
          <path d="M23.9995 28.4997C22.2669 28.5011 20.5609 28.0732 19.0341 27.2543C17.5073 26.4353 16.2072 25.2508 15.25 23.8066L17.749 22.1455C18.4333 23.1769 19.3621 24.0229 20.4527 24.6081C21.5433 25.1934 22.7618 25.4996 23.9995 25.4996C25.2372 25.4996 26.4557 25.1934 27.5463 24.6081C28.6369 24.0229 29.5657 23.1769 30.25 22.1455L32.749 23.8066C31.7918 25.2508 30.4917 26.4353 28.9649 27.2543C27.4381 28.0732 25.7321 28.5011 23.9995 28.4997Z" fill="#006F71"/>
          <path d="M30 12.0001C29.4067 12.0001 28.8266 12.1761 28.3333 12.5057C27.8399 12.8354 27.4554 13.3039 27.2284 13.8521C27.0013 14.4003 26.9419 15.0035 27.0576 15.5854C27.1734 16.1674 27.4591 16.7019 27.8787 17.1215C28.2982 17.541 28.8328 17.8267 29.4147 17.9425C29.9967 18.0583 30.5999 17.9988 31.1481 17.7718C31.6962 17.5447 32.1648 17.1602 32.4944 16.6669C32.8241 16.1735 33 15.5935 33 15.0001C33.0039 14.6051 32.9289 14.2132 32.7796 13.8475C32.6302 13.4818 32.4093 13.1495 32.13 12.8702C31.8506 12.5908 31.5184 12.37 31.1526 12.2206C30.7869 12.0712 30.395 11.9963 30 12.0001Z" fill="#006F71"/>
          <path d="M18 12.0001C17.4067 12.0001 16.8266 12.1761 16.3333 12.5057C15.8399 12.8354 15.4554 13.3039 15.2284 13.8521C15.0013 14.4003 14.9419 15.0035 15.0576 15.5854C15.1734 16.1674 15.4591 16.7019 15.8787 17.1215C16.2982 17.541 16.8328 17.8267 17.4147 17.9425C17.9967 18.0583 18.5999 17.9988 19.1481 17.7718C19.6962 17.5447 20.1648 17.1602 20.4944 16.6669C20.8241 16.1735 21 15.5935 21 15.0001C21.0039 14.6051 20.9289 14.2132 20.7796 13.8475C20.6302 13.4818 20.4093 13.1495 20.13 12.8702C19.8506 12.5908 19.5184 12.37 19.1526 12.2206C18.7869 12.0712 18.395 11.9963 18 12.0001Z" fill="#006F71"/>
          <path d="M26.6037 45L24 43.5L30 33H39C39.3942 33.0007 39.7846 32.9235 40.1488 32.773C40.5131 32.6225 40.8441 32.4015 41.1228 32.1228C41.4015 31.8441 41.6225 31.5131 41.773 31.1488C41.9235 30.7846 42.0007 30.3942 42 30V9C42.0007 8.60585 41.9235 8.21544 41.773 7.85116C41.6225 7.48688 41.4015 7.15589 41.1228 6.87718C40.8441 6.59847 40.5131 6.37752 40.1488 6.22699C39.7846 6.07647 39.3942 5.99933 39 6H9C8.60585 5.99933 8.21544 6.07647 7.85116 6.22699C7.48688 6.37752 7.15589 6.59847 6.87718 6.87718C6.59847 7.15589 6.37752 7.48688 6.22699 7.85116C6.07647 8.21544 5.99933 8.60585 6 9V30C5.99933 30.3942 6.07647 30.7846 6.22699 31.1488C6.37752 31.5131 6.59847 31.8441 6.87718 32.1228C7.15589 32.4015 7.48688 32.6225 7.85116 32.773C8.21544 32.9235 8.60585 33.0007 9 33H22.5V36H9C8.21203 36.0001 7.43175 35.845 6.70374 35.5436C5.97572 35.2421 5.31423 34.8001 4.75705 34.2429C4.19987 33.6858 3.75792 33.0243 3.45644 32.2963C3.15496 31.5682 2.99986 30.788 3 30V9C2.99976 8.212 3.1548 7.43168 3.45624 6.70362C3.75769 5.97556 4.19963 5.31403 4.75683 4.75683C5.31403 4.19963 5.97556 3.75769 6.70362 3.45624C7.43168 3.1548 8.212 2.99976 9 3H39C39.788 2.99976 40.5683 3.1548 41.2964 3.45624C42.0244 3.75769 42.686 4.19963 43.2432 4.75683C43.8004 5.31403 44.2423 5.97556 44.5438 6.70362C44.8452 7.43168 45.0002 8.212 45 9V30C45.0001 30.788 44.845 31.5682 44.5436 32.2963C44.2421 33.0243 43.8001 33.6858 43.243 34.2429C42.6858 34.8001 42.0243 35.2421 41.2963 35.5436C40.5682 35.845 39.788 36.0001 39 36H31.7469L26.6037 45Z" fill="#006F71"/>
          </g>
          <defs>
          <clipPath id="clip0_2623_11064">
          <rect width="48" height="48" fill="white"/>
          </clipPath>
          </defs>
          </svg>
          
        <div class="active"></div>
      </div>
    </div>
  </div>
  <hr class="my-2 -mx-5" />
  <div
    class="chat_content"
    #chatContentRef
    ngClass="height70"
  >
    <div class="time">
      <p>اليوم</p>
    </div>

    <div class="ai_answer">
      <div class="ai_chat_icon">
        <span>تحليل الأداء الذكي (Smart Performance Analyzer)</span
        >
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clip-path="url(#clip0_2623_11077)">
          <path d="M11.9998 14.2493C11.1335 14.2501 10.2805 14.0361 9.51706 13.6267C8.75365 13.2172 8.10359 12.6249 7.625 11.9028L8.8745 11.0723C9.21663 11.5879 9.68105 12.011 10.2264 12.3036C10.7717 12.5962 11.3809 12.7493 11.9998 12.7493C12.6186 12.7493 13.2278 12.5962 13.7731 12.3036C14.3184 12.011 14.7829 11.5879 15.125 11.0723L16.3745 11.9028C15.8959 12.6249 15.2459 13.2172 14.4824 13.6267C13.719 14.0361 12.866 14.2501 11.9998 14.2493Z" fill="#006F71"/>
          <path d="M15 6.00007C14.7033 6.00007 14.4133 6.08805 14.1666 6.25287C13.92 6.41769 13.7277 6.65196 13.6142 6.92605C13.5006 7.20014 13.4709 7.50174 13.5288 7.79271C13.5867 8.08368 13.7296 8.35095 13.9393 8.56073C14.1491 8.77051 14.4164 8.91337 14.7074 8.97125C14.9983 9.02913 15.2999 8.99942 15.574 8.88589C15.8481 8.77236 16.0824 8.5801 16.2472 8.33343C16.412 8.08675 16.5 7.79674 16.5 7.50007C16.5019 7.30255 16.4645 7.10662 16.3898 6.92375C16.3151 6.74089 16.2047 6.57476 16.065 6.43508C15.9253 6.2954 15.7592 6.18499 15.5763 6.11029C15.3935 6.0356 15.1975 5.99813 15 6.00007Z" fill="#006F71"/>
          <path d="M9 6.00007C8.70333 6.00007 8.41332 6.08805 8.16665 6.25287C7.91997 6.41769 7.72771 6.65196 7.61418 6.92605C7.50065 7.20014 7.47094 7.50174 7.52882 7.79271C7.5867 8.08368 7.72956 8.35095 7.93934 8.56073C8.14912 8.77051 8.41639 8.91337 8.70737 8.97125C8.99834 9.02913 9.29994 8.99942 9.57403 8.88589C9.84811 8.77236 10.0824 8.5801 10.2472 8.33343C10.412 8.08675 10.5 7.79674 10.5 7.50007C10.5019 7.30255 10.4645 7.10662 10.3898 6.92375C10.3151 6.74089 10.2047 6.57476 10.065 6.43508C9.92532 6.2954 9.75918 6.18499 9.57632 6.11029C9.39345 6.0356 9.19752 5.99813 9 6.00007Z" fill="#006F71"/>
          <path d="M13.3018 22.5L12 21.75L15 16.5H19.5C19.6971 16.5003 19.8923 16.4618 20.0744 16.3865C20.2566 16.3112 20.4221 16.2008 20.5614 16.0614C20.7008 15.9221 20.8112 15.7566 20.8865 15.5744C20.9618 15.3923 21.0003 15.1971 21 15V4.5C21.0003 4.30292 20.9618 4.10772 20.8865 3.92558C20.8112 3.74344 20.7008 3.57795 20.5614 3.43859C20.4221 3.29924 20.2566 3.18876 20.0744 3.1135C19.8923 3.03823 19.6971 2.99966 19.5 3H4.5C4.30292 2.99966 4.10772 3.03823 3.92558 3.1135C3.74344 3.18876 3.57795 3.29924 3.43859 3.43859C3.29924 3.57795 3.18876 3.74344 3.1135 3.92558C3.03823 4.10772 2.99966 4.30292 3 4.5V15C2.99966 15.1971 3.03823 15.3923 3.1135 15.5744C3.18876 15.7566 3.29924 15.9221 3.43859 16.0614C3.57795 16.2008 3.74344 16.3112 3.92558 16.3865C4.10772 16.4618 4.30292 16.5003 4.5 16.5H11.25V18H4.5C4.10601 18.0001 3.71588 17.9225 3.35187 17.7718C2.98786 17.621 2.65712 17.4001 2.37853 17.1215C2.09994 16.8429 1.87896 16.5121 1.72822 16.1481C1.57748 15.7841 1.49993 15.394 1.5 15V4.5C1.49988 4.106 1.5774 3.71584 1.72812 3.35181C1.87884 2.98778 2.09982 2.65702 2.37842 2.37842C2.65702 2.09982 2.98778 1.87884 3.35181 1.72812C3.71584 1.5774 4.106 1.49988 4.5 1.5H19.5C19.894 1.49988 20.2842 1.5774 20.6482 1.72812C21.0122 1.87884 21.343 2.09982 21.6216 2.37842C21.9002 2.65702 22.1212 2.98778 22.2719 3.35181C22.4226 3.71584 22.5001 4.106 22.5 4.5V15C22.5001 15.394 22.4225 15.7841 22.2718 16.1481C22.121 16.5121 21.9001 16.8429 21.6215 17.1215C21.3429 17.4001 21.0121 17.621 20.6481 17.7718C20.2841 17.9225 19.894 18.0001 19.5 18H15.8735L13.3018 22.5Z" fill="#006F71"/>
          </g>
          <defs>
          <clipPath id="clip0_2623_11077">
          <rect width="24" height="24" fill="white"/>
          </clipPath>
          </defs>
          </svg>
      </div>
      <p>
        {{ "أهلاً وسهلاً! أنا هنا لمساعدتك في أي شيء , كيف يمكنني خدمتك؟" }}
      </p>

    </div>
    
    <ng-container *ngIf="questionsAndAnswers.length>0">
      <ng-container *ngFor="let item of questionsAndAnswers">
      <ng-container >
        <div class="client_question" *ngIf="item.question">
          <div class="client_name">{{ userName }}</div>
          <div class="question">{{ item.question }}</div>
        </div>
        <div class="ai_answer">
          <div class="ai_chat_icon" *ngIf="item.answer">
            <span>تحليل الأداء الذكي (Smart Performance Analyzer)</span
              >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_2623_11077)">
              <path d="M11.9998 14.2493C11.1335 14.2501 10.2805 14.0361 9.51706 13.6267C8.75365 13.2172 8.10359 12.6249 7.625 11.9028L8.8745 11.0723C9.21663 11.5879 9.68105 12.011 10.2264 12.3036C10.7717 12.5962 11.3809 12.7493 11.9998 12.7493C12.6186 12.7493 13.2278 12.5962 13.7731 12.3036C14.3184 12.011 14.7829 11.5879 15.125 11.0723L16.3745 11.9028C15.8959 12.6249 15.2459 13.2172 14.4824 13.6267C13.719 14.0361 12.866 14.2501 11.9998 14.2493Z" fill="#006F71"/>
              <path d="M15 6.00007C14.7033 6.00007 14.4133 6.08805 14.1666 6.25287C13.92 6.41769 13.7277 6.65196 13.6142 6.92605C13.5006 7.20014 13.4709 7.50174 13.5288 7.79271C13.5867 8.08368 13.7296 8.35095 13.9393 8.56073C14.1491 8.77051 14.4164 8.91337 14.7074 8.97125C14.9983 9.02913 15.2999 8.99942 15.574 8.88589C15.8481 8.77236 16.0824 8.5801 16.2472 8.33343C16.412 8.08675 16.5 7.79674 16.5 7.50007C16.5019 7.30255 16.4645 7.10662 16.3898 6.92375C16.3151 6.74089 16.2047 6.57476 16.065 6.43508C15.9253 6.2954 15.7592 6.18499 15.5763 6.11029C15.3935 6.0356 15.1975 5.99813 15 6.00007Z" fill="#006F71"/>
              <path d="M9 6.00007C8.70333 6.00007 8.41332 6.08805 8.16665 6.25287C7.91997 6.41769 7.72771 6.65196 7.61418 6.92605C7.50065 7.20014 7.47094 7.50174 7.52882 7.79271C7.5867 8.08368 7.72956 8.35095 7.93934 8.56073C8.14912 8.77051 8.41639 8.91337 8.70737 8.97125C8.99834 9.02913 9.29994 8.99942 9.57403 8.88589C9.84811 8.77236 10.0824 8.5801 10.2472 8.33343C10.412 8.08675 10.5 7.79674 10.5 7.50007C10.5019 7.30255 10.4645 7.10662 10.3898 6.92375C10.3151 6.74089 10.2047 6.57476 10.065 6.43508C9.92532 6.2954 9.75918 6.18499 9.57632 6.11029C9.39345 6.0356 9.19752 5.99813 9 6.00007Z" fill="#006F71"/>
              <path d="M13.3018 22.5L12 21.75L15 16.5H19.5C19.6971 16.5003 19.8923 16.4618 20.0744 16.3865C20.2566 16.3112 20.4221 16.2008 20.5614 16.0614C20.7008 15.9221 20.8112 15.7566 20.8865 15.5744C20.9618 15.3923 21.0003 15.1971 21 15V4.5C21.0003 4.30292 20.9618 4.10772 20.8865 3.92558C20.8112 3.74344 20.7008 3.57795 20.5614 3.43859C20.4221 3.29924 20.2566 3.18876 20.0744 3.1135C19.8923 3.03823 19.6971 2.99966 19.5 3H4.5C4.30292 2.99966 4.10772 3.03823 3.92558 3.1135C3.74344 3.18876 3.57795 3.29924 3.43859 3.43859C3.29924 3.57795 3.18876 3.74344 3.1135 3.92558C3.03823 4.10772 2.99966 4.30292 3 4.5V15C2.99966 15.1971 3.03823 15.3923 3.1135 15.5744C3.18876 15.7566 3.29924 15.9221 3.43859 16.0614C3.57795 16.2008 3.74344 16.3112 3.92558 16.3865C4.10772 16.4618 4.30292 16.5003 4.5 16.5H11.25V18H4.5C4.10601 18.0001 3.71588 17.9225 3.35187 17.7718C2.98786 17.621 2.65712 17.4001 2.37853 17.1215C2.09994 16.8429 1.87896 16.5121 1.72822 16.1481C1.57748 15.7841 1.49993 15.394 1.5 15V4.5C1.49988 4.106 1.5774 3.71584 1.72812 3.35181C1.87884 2.98778 2.09982 2.65702 2.37842 2.37842C2.65702 2.09982 2.98778 1.87884 3.35181 1.72812C3.71584 1.5774 4.106 1.49988 4.5 1.5H19.5C19.894 1.49988 20.2842 1.5774 20.6482 1.72812C21.0122 1.87884 21.343 2.09982 21.6216 2.37842C21.9002 2.65702 22.1212 2.98778 22.2719 3.35181C22.4226 3.71584 22.5001 4.106 22.5 4.5V15C22.5001 15.394 22.4225 15.7841 22.2718 16.1481C22.121 16.5121 21.9001 16.8429 21.6215 17.1215C21.3429 17.4001 21.0121 17.621 20.6481 17.7718C20.2841 17.9225 19.894 18.0001 19.5 18H15.8735L13.3018 22.5Z" fill="#006F71"/>
              </g>
              <defs>
              <clipPath id="clip0_2623_11077">
              <rect width="24" height="24" fill="white"/>
              </clipPath>
              </defs>
              </svg>
              
          </div>
          <div class="flex justify-end gap-[2px] w-[70%] mt-4" *ngIf="item.loading">
            <div class="loader"></div>
          </div>
          <div class="flex justify-end gap-2 w-[70%] items-center" *ngIf="item.error">
            <div class="text-[#e31c1c] text-[15px]">{{item.answer}}</div>
            <i class="fa-solid fa-circle-exclamation" style="color: #e31c1c;"></i>
  
          </div>
          <div class="flex flex-col justify-end gap-[2px] w-[70%]" *ngIf="!item.loading&&!item.error">
            <p [innerHTML]="formatAnswer(item.answer)"></p>
           </div>
        </div>
      </ng-container>
      </ng-container>
    </ng-container>


  </div> 
  <hr class="my-2 -mx-5" />

  <div class="w-full flex gap-2">
    <div class="write_question" #writeQuestionRef>
      <div class="flex gap-2 w-full">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 20.2499H4.5C4.30109 20.2499 4.11032 20.1709 3.96967 20.0302C3.82902 19.8896 3.75 19.6988 3.75 19.4999V15.3105C3.75 15.2121 3.7694 15.1145 3.80709 15.0235C3.84478 14.9325 3.90003 14.8499 3.96967 14.7802L15.2197 3.53022C15.3603 3.38956 15.5511 3.31055 15.75 3.31055C15.9489 3.31055 16.1397 3.38956 16.2803 3.53022L20.4697 7.71956C20.6103 7.86021 20.6893 8.05097 20.6893 8.24989C20.6893 8.4488 20.6103 8.63956 20.4697 8.78022L9 20.2499Z" stroke="#006F71" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12.75 6L18 11.25" stroke="#006F71" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M20.2492 20.2501H8.99916L3.79688 15.0479" stroke="#006F71" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          
        <input
          type="text"
          class="write"
          placeholder="اكتب استفسارك هنا"
          [(ngModel)]="question"
          (keydown.enter)="send()"
        />
      </div>
  </div>
  <div class="send" (click)="send()"><i class="fa-solid fa-paper-plane"  style="color: #fff;"></i></div>
  </div>

  <hr class="my-3 -mx-5" />
  <div class="p-2 flex justify-end items-center">
    <img src="../../../assets/images/orbits_logo.svg" alt="">
  </div>
</p-overlayPanel>


</div>